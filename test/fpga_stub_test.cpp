#include "main.h"
#include "pads.h"

#include "fpga.h"
#include "fpga_stub_test.hpp"

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */

/**
 *
 */
void fpga_stub_test(FPGADriver *fpgap, size_t turns) {
  osalDbgCheck(fpgap->state == FPGA_READY);

  volatile fpgaword_t *ptr = fpgaGetSlicePtr(fpgap, FPGA_WB_SLICE_RESERVED1);
  volatile fpgaword_t pattern;

  while (turns--) {
    osalThreadSleepMilliseconds(50);
    pattern = ptr[0];
    green_led_toggle();
  }

  (void)pattern;
}
